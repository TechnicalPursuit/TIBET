language: node_js

sudo: required
dist: trusty

addons:
    apt:
        sources:
          - google-chrome
        packages:
          - google-chrome-stable
          - google-chrome-beta

node_js:
    - "8"

notifications:
    slack:
        secure: OlaOrklnLiLCrrDHB/4sNlp2oMyE4sQrVpc9tiN5UT4HI3N4iKm9FkbIGEjxn5aHFSWvd3yRc2X63sZD88+CxTS19igbQ0F8lnt7s/dsQnHrtJIo+id8E4WvdgsOM0nX7/V9LUJg01K7xHEzbA5xfAAhsjZ7VG3llMxnKsUxiXCndwEru4ni0ZKMNiIb0VN5IXhI252e172IEV2bC7S5WnWE/Hu8ZsI88dmdwlPnQOJIC50qNkMy8QF5F/REZx/+XjNv2zqT+RsQoarU9ZmVzoAvhWy257W9bwuNDpFgwZn9M3fxdJfsWO681ArTLZml2X7HNu57FhAhHzp2VmKXWU+IDkbbJTtLQRIDaMYfvX3uHVzmJ5N2TjlJLCsY7tNfN1SrSouohJfNRsNNscQwGsAmqPtkbZalHdSekeWIavWNUUtRSYxZaWRtrjsiG8gSaK37OOW/s9zoSkCFn/n2aM0gEiJHUn9HDtx2d6aKFodWfnI5X1CT7fg3kJ9vjk9LfSTz/ugJIdH0zTjEqBh8n1ja/Socac/r6bLa2iL2HQwJ8pRAnT3z2QZexxZ0Jf/wMll+n5iVwKix3jCHzw6ftNOiYAzWGca55eQBuCFu4qoUGiCx249/yYtPUvKDiyCrp9aZayHlddqanrbseRnzNe7Dic6mxL90wjbdEEpXqqI=
    email: false

before_install:
    - sudo apt-get update
    - sudo apt-get install -y libappindicator1 fonts-liberation
    - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    - sudo dpkg -i google-chrome*.deb
    - npm install npm@3.10 -g
    - npm cache clean

before_script:

    - npm link .
    - tibet build
    - cd ..
    - tibet clone travis
    - cd travis
    - tibet init --link
    - tibet lint
    - npm install -g karma-cli
    - npm install --save-dev karma
    - npm install --save-dev karma-chrome-launcher
    - npm install --save-dev karma-tibet
    - tibet config karma.boot.profile="main@contributor"
    - tibet config karma.script=":test --context='all'"
    - tibet config sherpa.enabled=false

    - export CHROME_BIN=/usr/bin/google-chrome
    - export DISPLAY=:99.0
    - sh -e /etc/init.d/xvfb start

    # Make sure to sleep for 3 seconds to give Chrome a chance to start under
    # xvfb
    - sleep 3

script:
    - karma start --debug
